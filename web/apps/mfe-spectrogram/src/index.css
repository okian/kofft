@tailwind base;
@tailwind components;
@tailwind utilities;

/*
  Theme colour variables
  ----------------------
  --accent-color and --primary-color are the canonical theme colours. The
  seekbar variables reference these to ensure consistency across themes and
  user customisation. Values are overridden by theme-specific classes and can
  be further overridden via settings.
*/
:root {
  /* Default colours mirror the japanese-a-light theme: black on white. */
  --accent-color: #000000;
  --primary-color: #000000;
  /* Seekbar theme variables */
  --seek-played: var(--accent-color);
  --seek-unplayed: var(--primary-color);
  --seek-buffered: rgba(59, 130, 246, 0.6); /* blue-500 with more opacity */
  --seek-focus: var(--accent-color);
  --seek-disabled: rgba(156, 163, 175, 0.4); /* gray-400 with more opacity */
  --seek-hover-played: rgb(96, 165, 250); /* blue-400 */
  --seek-hover-unplayed: rgb(156, 163, 175); /* gray-400 - brighter on hover */
  --seek-time-label: rgb(156, 163, 175); /* gray-400 */
}

/* Theme overrides matching the body class applied by the app */

/* Minimal black/white theme inspired by traditional Japanese design */
.theme-japanese-a-light {
  --accent-color: #000000;
  --primary-color: #000000;
}

/* Dark inversion of the monochrome Japanese palette */
.theme-japanese-a-dark {
  --accent-color: #ffffff;
  --primary-color: #ffffff;
}

/* Japanese flag motif: red sun with black or white text */
.theme-japanese-b-light {
  --accent-color: #e60026;
  --primary-color: #000000;
}

.theme-japanese-b-dark {
  --accent-color: #e60026;
  --primary-color: #ffffff;
}

/* Bauhaus primary colour blocks */
.theme-bauhaus-light {
  --accent-color: #ff0000;
  --primary-color: #0000ff;
}

.theme-bauhaus-dark {
  --accent-color: #ff0000;
  --primary-color: #ffff00;
}

/* Custom scrollbar styles */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(156, 163, 175, 0.3);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(156, 163, 175, 0.5);
}

/* Footer controls layout */
.footer-controls {
  height: 9rem; /* h-36 */
  display: flex;
  flex-direction: column;
  gap: 0.75rem; /* gap-3 */
  padding: 1rem 1.5rem; /* p-4 px-6 */
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* Ensure canvas roundRect is supported */
@supports not (ctx.roundRect) {
  .waveform-seekbar canvas {
    /* Fallback for browsers that don't support roundRect */
  }
}

@layer base {
  * {
    @apply border-neutral-800;
  }

  body {
    @apply bg-neutral-950 text-neutral-100 font-sans;
    font-feature-settings:
      "rlig" 1,
      "calt" 1;
  }

  html {
    @apply antialiased;
  }
}

@layer components {
  /* Layout system */
  .app-layout {
    @apply min-h-screen flex flex-col overflow-hidden;
  }

  .main-content {
    @apply flex-1 flex relative overflow-hidden;
  }

  .sidebar-left {
    @apply bg-neutral-900 border-r border-neutral-800 flex-shrink-0;
    @apply transition-all duration-300 ease-in-out;
  }

  .sidebar-right {
    @apply bg-neutral-900 border-l border-neutral-800 flex-shrink-0;
    @apply transition-all duration-300 ease-in-out;
  }

  .content-area {
    @apply flex-1 flex flex-col relative overflow-hidden;
    @apply transition-all duration-300 ease-in-out;
  }

  .footer-controls {
    @apply bg-neutral-900 border-t border-neutral-800 flex-shrink-0;
    @apply flex flex-col relative z-50;
    @apply transition-colors duration-300;
    @apply shadow-lg;
    @apply min-h-[4rem];
  }

  .track-info-area {
    width: min(100%, var(--info-max-ch));
    min-width: 0;
    flex-shrink: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    --title-size: calc(var(--base-title-size) + var(--title-font-step));
    --next-size: var(--base-title-size);
  }

  .track-info-area.next-active {
    --title-size: var(--base-title-size);
    --next-size: calc(var(--base-title-size) + var(--title-font-step));
  }

  .track-title {
    font-size: var(--title-size);
    transition: font-size var(--size-swap-duration) ease-in-out;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .next-info {
    font-size: var(--next-size);
    transition: font-size var(--size-swap-duration) ease-in-out;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .marquee-container {
    position: relative;
    overflow: hidden;
    min-width: 0;
  }

  .marquee-text {
    display: inline-block;
    white-space: nowrap;
  }

  .marquee-active {
    animation: marquee var(--marquee-duration) linear infinite;
    padding-right: 2ch;
  }

  .marquee-active::after {
    content: attr(data-text);
    padding-left: 2ch;
  }

  .marquee-container:hover .marquee-active,
  .marquee-container:focus-within .marquee-active {
    animation-play-state: paused;
  }

  @keyframes marquee {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-100%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .marquee-active {
      animation: none;
    }

    .track-title,
    .next-info {
      transition: none;
    }
  }

  /* Responsive layout utilities */
  .mobile-layout {
    @apply flex-col;
  }

  .tablet-layout {
    @apply flex-row;
  }

  .desktop-layout {
    @apply flex-row;
  }

  /* Mobile-specific styles */
  @media (max-width: 768px) {
    .app-layout {
      @apply h-screen;
    }

    .main-content {
      @apply flex-col;
    }

    .sidebar-left,
    .sidebar-right {
      @apply hidden;
    }

    .content-area {
      @apply flex-1;
    }

    .footer-controls {
      @apply min-h-[4rem];
    }
  }

  /* Tablet-specific styles */
  @media (min-width: 769px) and (max-width: 1024px) {
    .sidebar-left,
    .sidebar-right {
      @apply absolute top-0 h-full z-20 shadow-2xl;
    }

    .sidebar-left {
      @apply left-0;
    }

    .sidebar-right {
      @apply right-0;
    }
  }

  /* Desktop-specific styles */
  @media (min-width: 1025px) {
    .sidebar-left,
    .sidebar-right {
      @apply relative;
    }
  }

  /* Custom scrollbar styles */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: theme("colors.neutral.600") theme("colors.neutral.800");
  }

  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    @apply bg-neutral-800;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    @apply bg-neutral-600 rounded-full;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    @apply bg-neutral-500;
  }

  /* Focus styles */
  .focus-ring {
    @apply focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 focus:ring-offset-neutral-950;
  }

  /* Button base styles */
  .btn-base {
    @apply inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-ring disabled:pointer-events-none disabled:opacity-50;
  }

  .btn-primary {
    @apply btn-base bg-accent-blue text-white hover:bg-accent-blue/90;
  }

  .btn-secondary {
    @apply btn-base bg-neutral-800 text-neutral-100 hover:bg-neutral-700;
  }

  .btn-ghost {
    @apply btn-base hover:bg-neutral-800 hover:text-neutral-100;
  }

  /* Icon button styles */
  .icon-btn {
    @apply inline-flex items-center justify-center rounded-md p-2 text-neutral-400 transition-colors hover:text-neutral-100 hover:bg-neutral-800 focus-ring;
  }

  .icon-btn.active {
    @apply text-accent-blue bg-neutral-800;
  }

  /* Panel styles */
  .panel {
    @apply bg-neutral-900 border border-neutral-800 rounded-lg shadow-lg;
  }

  /* Sidebar styles */
  .sidebar {
    @apply bg-neutral-900 border-r border-neutral-800 transition-all duration-300 ease-in-out;
  }

  /* Spectrogram canvas styles */
  .spectrogram-canvas {
    @apply rounded-lg bg-neutral-950 border border-neutral-800;
  }

  /* Waveform styles */
  .waveform-bar {
    @apply bg-neutral-600 rounded-sm transition-all duration-150;
  }

  .waveform-bar.played {
    @apply bg-accent-blue;
  }

  .waveform-bar.current {
    @apply bg-accent-teal;
  }

  /* Seekbar container styles */
  .waveform-seekbar {
    @apply relative rounded-lg transition-all duration-200;
  }

  .waveform-seekbar:focus-within {
    @apply ring-2 ring-blue-400/20;
  }

  /* Slider styles */
  .slider-thumb {
    @apply appearance-none w-4 h-4 bg-neutral-300 rounded-full cursor-pointer border-0;
  }

  .slider-thumb:hover {
    @apply bg-neutral-200;
  }

  .slider-thumb:focus {
    @apply outline-none ring-2 ring-accent-blue ring-offset-2 ring-offset-neutral-950;
  }

  /* Animation classes */
  .animate-slide-in {
    animation: slideIn 0.3s ease-in-out;
  }

  .animate-fade-in {
    animation: fadeIn 0.3s ease-in-out;
  }

  .animate-scale-in {
    animation: scaleIn 0.15s ease-in-out;
  }

  .animate-pulse-subtle {
    animation: pulseSubtle 2s ease-in-out infinite;
  }
}

/* Marquee animation for overflowing text */
@keyframes marquee {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
}

.marquee {
  display: inline-block;
  white-space: nowrap;
  animation: marquee 8s linear infinite;
}

@layer utilities {
  /* Override py-1 to remove padding */
  .py-1 {
    padding-top: 0;
    padding-bottom: 0;
  }

  /* Text truncation */
  .text-truncate {
    @apply overflow-hidden text-ellipsis whitespace-nowrap;
  }

  /* Aspect ratio utilities */
  .aspect-square {
    aspect-ratio: 1 / 1;
  }

  .aspect-video {
    aspect-ratio: 16 / 9;
  }

  /* Glass effect */
  .glass {
    @apply bg-white/10 backdrop-blur-md border border-white/20;
  }

  /* Gradient text */
  .gradient-text {
    @apply bg-gradient-to-r from-accent-blue to-accent-teal bg-clip-text text-transparent;
  }

  /* Custom animations */
  @keyframes slideIn {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideInFromBottom {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes scaleIn {
    from {
      transform: scale(0.95);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  @keyframes pulseSubtle {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }

  @keyframes bounce {
    0%,
    20%,
    53%,
    80%,
    100% {
      transform: translate3d(0, 0, 0);
    }
    40%,
    43% {
      transform: translate3d(0, -8px, 0);
    }
    70% {
      transform: translate3d(0, -4px, 0);
    }
    90% {
      transform: translate3d(0, -2px, 0);
    }
  }

  /* Mobile-specific animations */
  .mobile-slide-up {
    animation: slideInFromBottom 0.3s ease-out;
  }

  .mobile-bounce {
    animation: bounce 0.6s ease-in-out;
  }

  /* Touch-friendly improvements */
  @media (hover: none) and (pointer: coarse) {
    /* Increase touch targets on touch devices */
    .icon-btn {
      @apply min-w-[44px] min-h-[44px];
    }

    /* Improve slider touch targets */
    input[type="range"] {
      @apply h-3;
    }

    /* Better focus indicators for touch */
    .focus-ring {
      @apply focus:ring-4 focus:ring-accent-blue/50;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .btn-primary {
      @apply border-2 border-current;
    }

    .icon-btn {
      @apply border border-transparent hover:border-current;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}
/* Control section styles */
.control-section {
  display: flex;
  gap: 0.25rem;
  align-items: stretch;
  --art-size: clamp(3rem, 20vw, 6rem);
  --base-size: clamp(0.5rem, 2vw, 0.875rem);
  --title-scale: 3;
  --meta-scale: 1;
  --gap: 0.125rem;
  --transition: cubic-bezier(0.2, 0, 0, 1);
}

.control-section.coming-up {
  --title-scale: 1;
  --meta-scale: 3;
  --gap: 0.0625rem;
}

.control-section .art-stack {
  position: relative;
  width: var(--art-size);
  height: var(--art-size);
}

.control-section .art-stack .album-art {
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: absolute;
  top: 0;
  left: 0;
  transition: transform 300ms var(--transition);
}

.control-section.coming-up .art-stack .album-art.current {
  transform: scale(1.05);
}

.control-section .art-stack .album-art.next {
  transform: rotate(-45deg) scale(0.8) translate(-20%, 20%);
}

.control-section .art-stack .album-art.next.animating {
  animation: albumArtSlideForward 300ms var(--transition) forwards;
}

@keyframes albumArtSlideForward {
  to {
    transform: rotate(0deg) scale(1) translate(0, 0);
  }
}

.control-section .text-stack {
  display: flex;
  flex-direction: column;
  height: var(--art-size);
}

.control-section .song-title {
  font-size: calc(var(--base-size) * var(--title-scale));
  line-height: 1;
  margin-bottom: var(--gap);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition:
    font-size 300ms var(--transition),
    line-height 300ms var(--transition),
    letter-spacing 300ms var(--transition),
    transform 300ms var(--transition);
}

.control-section .song-meta {
  font-size: calc(var(--base-size) * var(--meta-scale));
  line-height: 1;
  margin-top: auto;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition:
    font-size 300ms var(--transition),
    line-height 300ms var(--transition),
    letter-spacing 300ms var(--transition),
    transform 300ms var(--transition);
}

.control-section.fade-out .song-title,
.control-section.fade-out .song-meta {
  opacity: 0;
  transition: opacity var(--fade-duration) var(--transition);
}

.control-section.fade-in .song-title,
.control-section.fade-in .song-meta {
  opacity: 1;
  transition: opacity var(--fade-duration) var(--transition);
}
